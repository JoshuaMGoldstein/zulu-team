gcloud auth activate-service-account gcloud-build@zulu-team.iam.gserviceaccount.com --key-file=/root/gcloud-key.json

# Generating credentials for service account
gcloud iam service-accounts create gcloud-build --display-name="GCloud Build Service Account" --project=zulu-team
gcloud iam service-accounts list --project=zulu-team

#DISPLAY NAME                            EMAIL                                               DISABLED
GCloud Build Service Account            gcloud-build@zulu-team.iam.gserviceaccount.com      False

gcloud iam service-accounts keys list --iam-account=gcloud-build@zulu-team.iam.gserviceaccount.com

# To get a key json
#gcloud iam service-accounts keys create ./gcloud-key.json --iam-account=gcloud-build@zulu-team.iam.gserviceaccount.com


#TODO: Improve security by permission limiting.
gcloud projects add-iam-policy-binding zulu-team --member="serviceAccount:gcloud-build@zulu-team.iam.gserviceaccount.com" --role="roles/artifactregistry.admin"
gcloud projects add-iam-policy-binding zulu-team --member="serviceAccount:gcloud-build@zulu-team.iam.gserviceaccount.com" --role="roles/cloudbuild.builds.builder"
gcloud projects add-iam-policy-binding zulu-team --member="serviceAccount:gcloud-build@zulu-team.iam.gserviceaccount.com" --role="roles/secretmanager.admin"
gcloud projects add-iam-policy-binding zulu-team --member="serviceAccount:gcloud-build@zulu-team.iam.gserviceaccount.com" --role="roles/logging.bucketWriter"
#gcloud projects add-iam-policy-binding zulu-team --member="serviceAccount:gcloud-build@zulu-team.iam.gserviceaccount.com" --role="roles/secretmanager.secretAccessor"
$ETHUSD

#Adjust quotas at: https://console.cloud.google.com/iam-admin/quotas?service=cloudbuild.googleapis.com&inv=1&invt=Ab5ftQ&project=zulu-team

#Create a logging bucket - not useful
#gcloud logging buckets create gcloudbuildlogs --location=global


#Create a secret
echo "${GITHUB_PAT}" | gcloud secrets create GITHUB_PAT --data-file=-
gcloud secrets list --project=zulu-team

# The actual stuff!

$ ash

STDIN:
cd /workspace
git clone the repo

#build it - do not use --region or you will hit quote error.
gcloud builds submit --tag us-east4-docker.pkg.dev/zulu-team/zulu-team/gemini-docker:latest .
gcloud builds submit --config cloudbuild.json --service-account=gcloud-build@zulu-team.iam.gserviceaccount.com




#Further research
#https://stackoverflow.com/questions/57175062/using-docker-buildkit-on-google-cloud-build
#Can build without google cloud build if needed in future.